services:
  clientes:
    build:
      context: ./Clientes
      dockerfile: Dockerfile
    container_name: clientes
    ports:
      - "8081:8081"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:sqlite:/data/clientes.db
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.sqlite.JDBC
    volumes:
      - ./Clientes/data:/data
    restart: unless-stopped
    networks:
      - tpi-networks

  solicitudtraslado:
    build:
      context: ./SolicitudTraslado
      dockerfile: Dockerfile
    container_name: solicitudtranslado
    ports:
      - "8082:8082"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:sqlite:/data/solicitudtranslado.db
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.sqlite.JDBC
      - KEYCLOAK_SERVER_URL=http://keycloak:8080
      - KEYCLOAK_REALM=TPI-Realm
      - KEYCLOAK_CLIENT_ID=contenedores-api
    volumes:
      - ./SolicitudTraslado/data:/data
    restart: unless-stopped
    networks:
      - tpi-networks

  keycloak:
    image: quay.io/keycloak/keycloak:26.0.0
    container_name: keycloak
    ports:
      - "8080:8080"
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin123
      - KC_DB=dev-file  # Base de datos embebida para desarrollo
    command: start-dev
    networks:
      - tpi-networks
    volumes:
      - keycloak-data:/opt/keycloak/data

volumes:
  keycloak-data:



networks:
  tpi-networks:
    driver: bridge